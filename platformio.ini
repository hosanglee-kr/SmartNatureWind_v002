; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
    default_envs            = esp32-s3-n16r8
    data_dir                = ./src/v015/data_v015
    build_cache_dir         = ./.pio/build_cache

; --- 공통 설정 (Common Settings) ---
[common]
    platform = espressif32
    framework = arduino
    board_build.filesystem = littlefs
    monitor_speed = 115200
    monitor_filters = esp32_exception_decoder, colorize

    lib_deps =
        bblanchon/ArduinoJson @ ^7.4.2
        esp32async/ESPAsyncWebServer @ ^3.9.3
        h2zero/NimBLE-Arduino @ ^2.3.7
        adafruit/Adafruit Unified Sensor @ ^1.1.15
        adafruit/DHT sensor library @ ^1.4.6
        adafruit/Adafruit NeoPixel @ ^1.15.2

    build_unflags =
        -std=gnu++11
        -std=gnu++14
        -std=c++11
        -std=c++14

    build_flags =
        -std=gnu++17
        -D ASYNCWEBSERVER_REGEX
        -D CONFIG_BT_NIMBLE_ENABLED=1
        -D CONFIG_BT_BLE_ENABLED=1

    build_src_filter =
        +<*>
        -<v014_backup/>
        -<v015_backup/>
        -<v014/>

; --- 1. ESP32 DOIT DevKit V1 ---
[env:esp32doit]
    extends = common
    board = esp32doit-devkit-v1

    lib_deps = ${common.lib_deps}
    build_unflags = ${common.build_unflags}
    build_flags = ${common.build_flags}
    build_src_filter = ${common.build_src_filter}

; --- 2. ESP32-S3 Zero ---
[env:esp32-s3-zero]
    extends = common
    board = esp32-s3-devkitc-1
    board_build.mcu = esp32s3
    board_build.f_cpu = 240000000L
    board_build.f_flash = 80000000L
    board_build.flash_mode = qio
    board_upload.flash_size = 4MB
    board_build.partitions = default_4MB.csv

    lib_deps = ${common.lib_deps}
    build_unflags = ${common.build_unflags}
    build_flags =
        ${common.build_flags}
        -DBOARD_HAS_PSRAM
        -mfix-esp32-psram-cache-issue
        -DARDUINO_USB_CDC_ON_BOOT=1

    build_src_filter = ${common.build_src_filter}

; --- 3. ESP32-S3-N16R8 (16MB Flash / 8MB PSRAM) ---
[env:esp32-s3-n16r8]
    extends = common
    board = esp32s3box
    board_build.arduino.memory_type = qio_opi
    board_build.flash_mode = qio
    board_upload.flash_size = 16MB
    board_build.arduino.partitions = default_16MB.csv

    lib_deps = ${common.lib_deps}
    build_unflags = ${common.build_unflags}
    build_flags =
        ${common.build_flags}
        -D ARDUINO_USB_MODE=1
        -D ARDUINO_USB_CDC_ON_BOOT=1
        -D BOARD_HAS_PSRAM
        -D BOARD_HAS_PSRAM_OPI
        -mfix-esp32-psram-cache-issue

    build_src_filter = ${common.build_src_filter}

    ; ; 디버그 전용 설정
    ; debug_tool = esp-builtin
    ; upload_protocol = esp-builtin
    ; debug_speed = 2000
    ; debug_init_cmds =
    ;     define pio_reset_halt_target
    ;         monitor reset halt
    ;     end
    ;     define pio_reset_run_target
    ;         monitor reset run
    ;     end
    ;     target remote :3333
    ;     set remotetimeout 20
    ;     pio_reset_halt_target
    ;     $__init_break
